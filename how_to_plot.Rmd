---
title: How to Plot
author: Tobias Bauer
date: 2024-12-04
output: 
    html_document:
        toc: TRUE
editor_options: 
  chunk_output_type: inline
---

# How to plot plant-pollinator (or any other) webs with bipartite

First we have to install and then load the `bipartite`-package.

> **NOTE:** The new plotting functionality is currently still under development and not yet included in the CRAN version of `bipartite`. For demonstration purposes we will install the development version from github using the `devtools`-package. On Windows make sure the `RTools` are installed.

```{r}
devtools::install_github("https://github.com/TobiasB22/bipartite", 
                         ref = "plotweb_v2", subdir = "bipartite")
library(bipartite)
```

## Plotting the old way

To visualize the plotting capabilities of `bipartite` we will use a plant-pollinator web included in the package namely `Safariland`.

```{r}
?Safariland
dim(Safariland)
str(Safariland)
```

As we can see its a 9x27 integer matrix. The help reveals that the 9 rows represent plant species and the 27 columns represent different pollinators.

Now up to the current version `v2.20` of `bipartite` the standard way to visualize this network would be to simply call the function `plotweb`.

> **NOTE:** To increase the plotting area we will use `fig.width = 10` and `fig.height = 10` in the following chunks. This extends the area from the default size of 7x5 inches to 10x10 inches.

```{r, fig.width = 10, fig.height = 10}
?plotweb
plotweb(Safariland)
```

However, as you can see, for larger networks the placement of the labels quickly becomes somewhat confusing. To demonstrate the function better we will plot only the first 5 species of both plants and pollinators next.

```{r, fig.width = 10, fig.height = 10}
plotweb(Safariland[1:6, 1:6])
```

## Plotting the new way

This development version contains a refined version of the plotting function currently called `plotweb_v2`. Among other things the stacking of labels is replaced in that version.

```{r, fig.width=10, fig.height=10}
?plotweb_v2
plotweb_v2(Safariland)
```

The error message tells us, that with the current text size, the labels can't be plotted without overlap. This error only occurs when the option `spacing = "auto"` is set. With this option the plot is arranged such that the maximal space is used without overlapping any labels.

So to solve this issue there are multiple solutions. The most intuitive would be decrease the `text_size` option to a value between 0 and 1 that is small enough to plot. The other would be to ignore the error and set the `spacing` to a fixed value.

```{r, fig.width=10, fig.height=10}
plotweb_v2(Safariland, text_size = 0.1)
plotweb_v2(Safariland, spacing = 0.5)
```

Obviously both options are ideal. A more readable way however is to rotate the labels 90° with the `srt`-argument.

```{r, fig.width=10, fig.height=10}
plotweb_v2(Safariland, srt = 90)
```

### Switching to a horizontal plot

Another possibility is to rotate the whole plot by 90° altogether. This can be accomplished by setting `horizontal = TRUE`.

```{r, fig.width=10, fig.height=10}
plotweb_v2(Safariland, horizontal = TRUE)
```

Now we are able to clearly read every single label and interpret the plotted interactions.

## Sorting the web

By default the species in the plot are arranged just like the rows and columns in the given web matrix. So the first row/column is plotted at the bottom/left of the plot. So to arrange the plot in a specific order that order just has to be given during the call of `plotweb_v2`.

```{r, fig.width=10, fig.height=10}
plotweb_v2(Safariland[rev(rownames(Safariland)), ], horizontal = TRUE)
```

Now the plant species are plotted in reverse order.

However a built-in call to `sortweb` is also possible with the argument `sorting`. The options are the same as for `sortweb`. So `dec` orders the species in decreasing row/column totals, `inc` orders by increasing totals, and `cca` performs a cca algorithm which might reduce link crossings in the plot.

```{r, fig.width=10, fig.height=10}
plotweb_v2(Safariland, 
           horizontal = TRUE, sorting = "dec")
plotweb_v2(Safariland, 
           horizontal = TRUE, sorting = "inc")
plotweb_v2(Safariland, 
           horizontal = TRUE, sorting = "cca")
```

## Adding independent abundances

In some cases beside the recoreded interactions there might also be data about the actual abundance of each or some species available. Now it might be interesting to alter the plot so that the boxes visualize these abundances while still representing the recorded interaction preferences via the link widths. This can be accomplished with the two arguments `higher_abundances` and `lower_abundances`.

These accept a named vector each for the higher trophic level species (columns) and lower trophic level species (rows).

Since we don't have actual recorded abundances we will generate some randomly for demonstration.

```{r, fig.width=10, fig.height=10}
n_lower_species <- nrow(Safariland)
lower_abundances <- sample(0:100, n_lower_species, replace = TRUE)
names(lower_abundances) <- rownames(Safariland)
plotweb_v2(Safariland, 
           horizontal = TRUE,
           lower_abundances = lower_abundances)
plotweb_v2(Safariland, 
           horizontal = TRUE,
           sorting = "cca",
           lower_abundances = lower_abundances)
```

We now have abundances for the pollinator species that were randomly drawn form a uniform distribution between 0 and 100. As we can see the box sizes on the left are more homogenous.

We can also see that some of the links are increasing or decreasing in size from the left to the right.

```{r, fig.width=10, fig.height=10}
higher_abundances <- sample(0:1000, n_higher_species, replace = TRUE)
plotweb_v2(Safariland, 
           horizontal = TRUE,
           higher_abundances = higher_abundances,
           scaling = "relative")
plotweb_v2(Safariland, 
           horizontal = TRUE,
           higher_abundances = higher_abundances,
           scaling = "absolute")
```

## Adding additional abundances

```{r, fig.width=10, fig.height=10}
plotweb_v2(Safariland, 
           horizontal = TRUE,
           add_lower_abundances = lower_abundances)
```

## Changing the style

### Switching to curved links

```{r, fig.width=10, fig.height=10}
plotweb_v2(Safariland, 
           srt = 90,
           curved_links = TRUE)
plotweb_v2(Safariland, 
           horizontal = TRUE,
           curved_links = TRUE)
```

### Making the species labels cursive

```{r, fig.width=10, fig.height=10}
plotweb_v2(Safariland, 
           horizontal = TRUE,
           curved_links = TRUE,
           higher_italic = TRUE,
           lower_italic = TRUE)
```

### Changing the color of all species

```{r, fig.width = 10, fig.height = 10}
plotweb_v2(Safariland, 
           horizontal = TRUE,
           curved_links = TRUE,
           higher_color = "orange",
           lower_color = "darkgreen")
```

### Changing the color of some species

```{r, fig.width = 10, fig.height = 10}
lower_color <- rep("black", nrow(Safariland))
names(lower_color) <- rownames(Safariland)
lower_color["Alstroemeria aurea"] <- "orange"
plotweb_v2(Safariland, 
           horizontal = TRUE,
           curved_links = TRUE,
           lower_color = lower_color)
```

### Changing the color of the links

```{r, fig.width = 10, fig.height = 10}
plotweb_v2(Safariland, 
           horizontal = TRUE,
           curved_links = TRUE,
           lower_color = lower_color,
           link_color = "lower")
plotweb_v2(Safariland, 
           horizontal = TRUE,
           curved_links = TRUE,
           higher_color = "orange",
           lower_color = "darkgreen",
           link_color = "gray")
```

### Changing the color of additional abundances

```{r, fig.width = 10, fig.height = 10}
plotweb_v2(Safariland, 
           horizontal = TRUE,
           add_lower_abundances = lower_abundances,
           lower_add_color = "darkgreen")
```

## Plotting 2 webs

```{r, fig.width = 10, fig.height = 10}
plot2webs_v2(Safariland, vazarr,
             text_size = 0.7)
plot2webs_v2(Safariland, vazarr,
             text_size = 0.7,
             horizontal = T)
```

### Changing the middle

```{r, fig.width = 10, fig.height = 10}
plot2webs_v2(Safariland, vazarr, 
             horizontal = T,
             middle = "lower",
             text_size = 0.7)
```
